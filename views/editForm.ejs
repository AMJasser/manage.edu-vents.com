<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>EDU-vents</title>
    <meta name="description"
        content="EDU-vents - This website was created solely for the help of Philomaths. It would show the most important educational events happening around the world, providing an easy-to-use portal for them.">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="/images/seco.ico">
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/stylesheets/style.css">
    <link rel="stylesheet" href="/scripts/codemirror/lib/codemirror.css">
    <link rel="stylesheet" href="/scripts/codemirror/theme/ayu-mirage.css">
    <script src="/scripts/codemirror/lib/codemirror.js"></script>
    <script src="/scripts/codemirror/mode/htmlmixed/htmlmixed.js"></script>

    <% if (typeof msg !== "undefined") { %>
    <script>alert("<%= msg %>")</script>
    <% } %>
</head>

<body>
    <header>
        <h1 onclick="location.href='/'">
            <img alt="logo" src="/images/logo.jpg">
            <span>EDU-vents</span>
        </h1>
        <nav>
            <a href="/logout">Logout</a>
        </nav>
    </header>
    <div class="sections">
        <section style="text-align: initial;">
            <h2 style="color: black;">Edit Form</h2>
            <form action="/forms/<%= form.url %>?_method=PATCH" method="POST" name="formForm" onsubmit="return validateForm()">
                <label>Form Name<input type="text" name="name" required <% if (typeof form.name !== "undefined") { %> value="<%= form.name %>" <% } %>></label>

                <% 
                    if (typeof form.endDate !== "undefined") {
                        var endY = form.endDate.getFullYear();
                        var endM = form.endDate.getMonth() + 1;
                        endM = "0" + endM;
                        var endD = "0" + form.endDate.getDate();
                        endD = "0" + endD;

                        var endDate = endY + "-" + endM.slice(-2) + "-" + endD.slice(-2);
                    }
                %>

                <label>End Date<input type="date" name="endDate" required <% if (typeof form.endDate !== "undefined") { %> value="<%= endDate %>" <% } %>></label>
                <textarea id="code" name="code"><% if (typeof form.html !== "undefined") { %><%= form.html %><% } %></textarea>
                <input type="submit">
            </form>
        </section>
    </div>
    <script type="text/javascript">
        window.onload = function() {
            window.editor = CodeMirror.fromTextArea(code, {
                mode: "htmlmixed",
                theme: "ayu-mirage",
                lineNumbers: true,
                lineWrapping: true,
                gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"]
            });
        };

        function validateForm() {
            var newFormName = document.forms["formForm"]["name"].value.toLowerCase().replace(/ /g, "").replace(/[^a-zA-Z0-9-_\.]/g, '');
            var formNames = "<% if (typeof formNames !== 'undefined') { %><%= formNames %><% } %>";
            var result = true;
            if (formNames !== "") {
                formNames = formNames.split(",");
                formNames.forEach(function(formName) {
                    if (newFormName === formName) {
                        alert("There is another form with the same name.");
                        result = false;
                    }
                });
            }
            return result;
        }
    </script>
</body>

</html>